# Copyright (C) 2018 Tetsuya Miura <miute.dev@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


# See http://www.microsoft.com/typography/otspec/languagetags.htm
language_tag_to_iso639_codes_map = {
    'ABA': ['abq'],
    'ABK': ['abk'],
    'ACH': ['ach'],
    'ACR': ['acr'],
    'ADY': ['ady'],
    'AFK': ['afr'],
    'AFR': ['aar'],
    'AGW': ['ahg'],
    'AIO': ['aio'],
    'AKA': ['aka'],
    'ALS': ['gsw'],
    'ALT': ['atv', 'alt'],
    'AMH': ['amh'],
    'ANG': ['ang'],

    'ARA': ['ara'],
    'ARG': ['arg'],
    'ARI': ['aiw'],
    'ARK': ['mhv', 'rmz', 'rki'],
    'ASM': ['asm'],
    'AST': ['ast'],
    'ATH': ['apk', 'apj', 'apl', 'apm', 'apw', 'nav', 'bea', 'sek', 'bcr',
            'caf', 'crx', 'clc', 'gwi', 'haa', 'chp', 'dgr', 'scs', 'xsl',
            'srs', 'ing', 'hoi', 'koy', 'hup', 'ktw', 'mvb', 'wlk', 'coq',
            'ctc', 'gce', 'tol', 'tuu', 'kkz', 'tgx', 'tht', 'aht', 'tfn',
            'taa', 'tau', 'tcb', 'kuu', 'tce', 'ttm', 'txc'],
    'AVR': ['ava'],
    'AWA': ['awa'],
    'AYM': ['aym'],
    'AZB': ['azb'],
    'AZE': ['aze'],
    'BAD': ['bfq'],
    'BAD0': ['bad'],
    'BAG': ['bfy'],
    'BAL': ['krc'],
    'BAN': ['ban'],
    'BAR': ['bar'],
    'BAU': ['bci'],
    'BBC': ['bbc'],

    'BCH': ['bcq'],

    'BDY': ['bdy'],
    'BEL': ['bel'],
    'BEM': ['bem'],
    'BEN': ['ben'],
    'BGC': ['bgc'],
    'BGQ': ['bgq'],
    'BGR': ['bul'],
    'BHI': ['bhi', 'bhb'],
    'BHO': ['bho'],
    'BIK': ['bik', 'bhk', 'bcl', 'bto', 'cts', 'bln'],
    'BIL': ['byn'],
    'BIS': ['bis'],
    'BJJ': ['bjj'],
    'BKF': ['bla'],
    'BLI': ['bal'],
    'BLK': ['blk'],
    'BLN': ['bjt', 'ble'],
    'BLT': ['bft'],
    'BMB': ['bam'],

    'BOS': ['bos'],
    'BPY': ['bpy'],
    'BRE': ['bre'],
    'BRH': ['brh'],
    'BRI': ['bra'],
    'BRM': ['mya'],
    'BRX': ['brx'],
    'BSH': ['bak'],
    'BSK': ['bsk'],
    'BTI': ['btb'],
    'BTS': ['bts'],
    'BUG': ['bug'],
    'BYV': ['byv'],
    'CAK': ['cak'],
    'CAT': ['cat'],
    'CBK': ['cbk'],
    'CCHN': ['cco', 'chj', 'chq', 'chz', 'cle', 'cnl', 'cnt', 'cpa', 'csa',
             'cso', 'cte', 'ctl', 'cuc', 'cvn'],
    'CEB': ['ceb'],
    'CHE': ['che'],
    'CHG': ['sgw'],
    'CHH': ['hne'],
    'CHI': ['nya'],
    'CHK': ['ckt'],
    'CHK0': ['chk'],
    'CHO': ['cho'],
    'CHP': ['chp'],
    'CHR': ['chr'],
    'CHA': ['cha'],
    'CHU': ['chv'],
    'CHY': ['chy'],
    'CGG': ['cgg'],
    'CJA': ['cja'],
    'CJM': ['cjm'],
    'CMR': ['swb', 'wlc', 'wni', 'zdj'],
    'COP': ['cop'],
    'COR': ['cor'],
    'COS': ['cos'],
    'CPP': ['cpp'],
    'CRE': ['cre'],
    'CRR': ['crx', 'caf'],
    'CRT': ['crh'],
    'CSB': ['csb'],
    'CSL': ['chu'],
    'CSY': ['ces'],
    'CTG': ['ctg'],
    'CUK': ['cuk'],
    'DAN': ['dan'],
    'DAR': ['dar'],
    'DAX': ['dax'],
    'DCR': ['cwd'],
    'DEU': ['deu'],
    'DGO': ['dgo'],
    'DGR': ['doi'],
    'DHG': ['dhg'],
    'DHV': ['div'],  # deprecated
    'DIQ': ['diq'],
    'DIV': ['div'],
    'DJR': ['dje'],
    'DJR0': ['djr'],
    'DNG': ['ada'],
    'DNJ': ['dnj'],
    'DNK': ['din'],
    'DRI': ['prs'],
    'DUJ': ['duj'],
    'DUN': ['dng'],
    'DZN': ['dzo'],
    'EBI': ['igb'],
    'ECR': ['crj', 'crl'],
    'EDO': ['bin'],
    'EFI': ['efi'],
    'ELL': ['ell'],
    'EMK': ['emk'],
    'ENG': ['eng'],
    'ERZ': ['myv'],
    'ESP': ['spa'],
    'ESU': ['esu'],
    'ETI': ['est'],
    'EUQ': ['eus'],
    'EVK': ['evn'],
    'EVN': ['eve'],
    'EWE': ['ewe'],
    'FAN': ['acf'],
    'FAN0': ['fan'],
    'FAR': ['fas'],
    'FAT': ['fat'],
    'FIN': ['fin'],
    'FJI': ['fij'],
    'FLE': ['vls'],
    'FMP': ['fmp'],
    'FNE': ['enf'],
    'FON': ['fon'],
    'FOS': ['fao'],
    'FRA': ['fra'],
    'FRC': ['frc'],
    'FRI': ['fry'],
    'FRL': ['fur'],
    'FRP': ['frp'],
    'FTA': ['fuf'],
    'FUL': ['ful'],
    'FUV': ['fuv'],
    'GAD': ['gaa'],
    'GAE': ['gla'],
    'GAG': ['gag'],
    'GAL': ['glg'],

    'GAW': ['gbm'],
    'GEZ': ['gez'],
    'GIH': ['gih'],
    'GIL': ['niv'],
    'GIL0': ['gil'],
    'GKP': ['gkp'],
    'GLK': ['glk'],
    'GMZ': ['guk'],
    'GNN': ['gnn'],
    'GOG': ['gog'],
    'GON': ['gon'],
    'GRN': ['kal'],
    'GRO': ['grt'],
    'GUA': ['grn'],
    'GUC': ['guc'],
    'GUF': ['guf'],
    'GUJ': ['guj'],
    'GUZ': ['guz'],
    'HAI': ['hat'],
    'HAL': ['flm'],
    'HAR': ['hoj'],
    'HAU': ['hau'],
    'HAW': ['haw'],
    'HAY': ['hay'],
    'HAZ': ['haz'],
    'HBN': ['amf'],
    'HER': ['her'],
    'HIL': ['hil'],
    'HIN': ['hin'],
    'HMA': ['mrj'],
    'HMN': ['hmn'],
    'HMO': ['hmo'],
    'HND': ['hno', 'hnd'],
    'HO': ['hoc'],
    'HRI': ['har'],
    'HRV': ['hrv'],
    'HUN': ['hun'],
    'HYE': ['hye'],
    'HYE0': ['hye'],
    'IBA': ['iba'],
    'IBB': ['ibb'],
    'IBO': ['ibo'],
    'IJO': ['ijc'],
    'IDO': ['ido'],
    'ILE': ['ile'],
    'ILO': ['ilo'],
    'INA': ['ina'],
    'IND': ['ind'],
    'ING': ['inh'],
    'INU': ['iku'],
    'IPK': ['ipk'],

    'IRI': ['gle'],
    'IRT': ['gle'],
    'ISL': ['isl'],
    'ISM': ['smn'],
    'ITA': ['ita'],
    'IWR': ['heb'],
    'JAM': ['jam'],
    'JAN': ['jpn'],
    'JAV': ['jav'],
    'JBO': ['jbo'],
    'JCT': ['jct'],
    'JII': ['yid'],
    'JUD': ['lad'],
    'JUL': ['dyu'],
    'KAB': ['kbd'],
    'KAB0': ['kab'],
    'KAC': ['kfr'],
    'KAL': ['kln'],
    'KAN': ['kan'],
    'KAR': ['krc'],
    'KAT': ['kat'],
    'KAZ': ['kaz'],
    'KDE': ['kde'],
    'KEA': ['kea'],
    'KEB': ['ktb'],
    'KEK': ['kek'],
    'KGE': ['kat'],
    'KHA': ['kjh'],
    'KHK': ['kca'],
    'KHM': ['khm'],
    'KHS': ['kca'],
    'KHT': ['kht'],
    'KHV': ['kca'],
    'KHW': ['khw'],
    'KIK': ['kik'],
    'KIR': ['kir'],
    'KIS': ['kqs', 'kss'],
    'KIU': ['kiu'],
    'KJD': ['kjd'],
    'KJP': ['kjp'],
    'KKN': ['kex'],
    'KLM': ['xal'],
    'KMB': ['kam'],
    'KMN': ['kfy'],
    'KMO': ['kmw'],
    'KMS': ['kxc'],
    'KMZ': ['kmz'],
    'KNR': ['kau'],
    'KOD': ['kfa'],
    'KOH': ['okm'],
    'KOK': ['kok'],
    'KON': ['ktu'],
    'KOM': ['kom'],
    'KON0': ['kon'],
    'KOP': ['koi'],
    'KOR': ['kor'],
    'KOS': ['kos'],
    'KOZ': ['kpv'],
    'KPL': ['kpe'],
    'KRI': ['kri'],
    'KRK': ['kaa'],
    'KRL': ['krl'],
    'KRM': ['kdr'],
    'KRN': ['kar'],
    'KRT': ['kqy'],
    'KSH': ['kas'],
    'KSH0': ['ksh'],
    'KSI': ['kha'],
    'KSM': ['sjd'],
    'KSW': ['ksw'],
    'KUA': ['kua'],
    'KUI': ['kxu'],
    'KUL': ['kfx'],
    'KUM': ['kum'],
    'KUR': ['kur'],
    'KUU': ['kru'],
    'KUY': ['kdt'],
    'KYK': ['kpy'],
    'KYU': ['kyu'],
    'LAD': ['lld'],
    'LAH': ['bfu'],
    'LAK': ['lbe'],
    'LAM': ['lmn'],
    'LAO': ['lao'],
    'LAT': ['lat'],
    'LAZ': ['lzz'],
    'LCR': ['crm'],
    'LDK': ['lbj'],
    'LEZ': ['lez'],
    'LIJ': ['lij'],
    'LIM': ['lim'],
    'LIN': ['lin'],
    'LIS': ['lis'],
    'LJP': ['ljp'],
    'LKI': ['lki'],
    'LMA': ['mhr'],
    'LMB': ['lif'],
    'LMO': ['lmo'],
    'LMW': ['ngl'],
    'LOM': ['lom'],
    'LRC': ['lrc', 'luz', 'bqi', 'zum'],
    'LSB': ['dsb'],
    'LSM': ['smj'],
    'LTH': ['lit'],
    'LTZ': ['ltz'],
    'LUA': ['lua'],
    'LUB': ['lub'],
    'LUG': ['lug'],
    'LUH': ['luy'],
    'LUO': ['luo'],
    'LVI': ['lav'],
    'MAD': ['mad'],
    'MAG': ['mag'],
    'MAH': ['mah'],
    'MAJ': ['mpe'],
    'MAK': ['vmw'],
    'MAL': ['mal'],
    'MAM': ['mam'],
    'MAN': ['mns'],
    'MAP': ['arn'],
    'MAR': ['mar'],
    'MAW': ['mwr', 'dhd', 'rwr', 'mve', 'wry', 'mtr', 'swv'],
    'MBN': ['kmb'],
    'MBO': ['mbo'],
    'MCH': ['mnc'],
    'MCR': ['crm'],
    'MDE': ['men'],
    'MDR': ['mdr'],
    'MEN': ['mym'],
    'MER': ['mer'],
    'MFE': ['mfe'],
    'MIN': ['min'],
    'MIZ': ['lus'],
    'MKD': ['mkd'],
    'MKR': ['mak'],
    'MKW': ['mkw'],
    'MLE': ['mdy'],
    'MLG': ['mlg'],
    'MLN': ['mlq'],
    'MLR': ['mal'],
    'MLY': ['msa'],
    'MND': ['mnk'],
    'MNG': ['mon'],
    'MNI': ['mni'],
    'MNK': ['man', 'mnk', 'myq', 'mku', 'msc', 'emk', 'mwk', 'mlq'],
    'MNX': ['glv'],
    'MOH': ['moh'],
    'MOK': ['mdf'],
    'MOL': ['mol'],
    'MON': ['mnw'],

    'MOS': ['mos'],
    'MRI': ['mri'],
    'MTH': ['mai'],
    'MTS': ['mlt'],
    'MUN': ['unr'],
    'MUS': ['mus'],
    'MWL': ['mwl'],
    'MWW': ['mww'],
    'MYN': ['myn'],
    'MZN': ['mzn'],
    'NAG': ['nag'],
    'NAH': ['nah'],
    'NAN': ['gld'],
    'NAP': ['nap'],
    'NAS': ['nsk'],
    'NAU': ['nau'],
    'NAV': ['nav'],
    'NCR': ['csw'],
    'NDB': ['nbl', 'nde'],
    'NDC': ['ndc'],
    'NDG': ['ndo'],
    'NDS': ['nds'],
    'NEP': ['nep'],
    'NEW': ['new'],
    'NGA': ['nga'],

    'NHC': ['csw'],
    'NIS': ['dap'],
    'NIU': ['niu'],
    'NKL': ['nyn'],
    'NKO': ['nqo'],
    'NLD': ['nld'],
    'NOE': ['noe'],
    'NOG': ['nog'],
    'NOR': ['nob'],
    'NOV': ['nov'],
    'NSM': ['sme'],
    'NSO': ['nso'],
    'NTA': ['nod'],
    'NTO': ['epo'],
    'NYM': ['nym'],
    'NYN': ['nno'],
    'NZA': ['nza'],
    'OCI': ['oci'],
    'OCR': ['ojs'],
    'OJB': ['oji'],
    'ORI': ['ori'],
    'ORO': ['orm'],
    'OSS': ['oss'],
    'PAA': ['sam'],
    'PAG': ['pag'],
    'PAL': ['pli'],
    'PAM': ['pam'],
    'PAN': ['pan'],
    'PAP': ['plp'],
    'PAP0': ['pap'],
    'PAS': ['pus'],
    'PAU': ['pau'],
    'PCC': ['pcc'],
    'PCD': ['pcd'],
    'PDC': ['pdc'],
    'PGR': ['ell'],
    'PHK': ['phk'],
    'PIH': ['pih'],
    'PIL': ['fil'],
    'PLG': ['pce', 'rbb', 'pll'],
    'PLK': ['pol'],
    'PMS': ['pms'],
    'PNB': ['pnb'],
    'POH': ['poh'],
    'PON': ['pon'],
    'PRO': ['pro'],
    'PTG': ['por'],
    'PWO': ['pwo'],
    'QIN': ['bgr', 'cnh', 'cnw', 'czt', 'sez', 'tcp', 'csy', 'ctd', 'flm',
            'pck', 'tcz', 'zom', 'cmr', 'dao', 'hlt', 'cka', 'cnk', 'mrh',
            'cbl', 'cnb', 'csh'],
    'QUC': ['quc'],
    'QUH': ['quh'],
    'QUZ': ['quz'],
    'QVI': ['qvi'],
    'QWH': ['qwh'],
    'RAJ': ['raj'],
    'RAR': ['rar'],
    'RBU': ['bxr'],
    'RCR': ['atj'],
    'REJ': ['rej'],
    'RIA': ['ria'],
    'RIF': ['rif'],
    'RIT': ['rit'],
    'RKW': ['rkw'],
    'RMS': ['roh'],
    'RMY': ['rmy'],
    'ROM': ['ron'],
    'ROY': ['rom'],
    'RSY': ['rue'],
    'RTM': ['rtm'],
    'RUA': ['kin'],
    'RUN': ['run'],
    'RUP': ['rup'],
    'RUS': ['rus'],
    'SAD': ['sck'],
    'SAN': ['san'],
    'SAS': ['sas'],
    'SAT': ['sat'],
    'SAY': ['chp'],
    'SCN': ['scn'],
    'SCO': ['sco'],
    'SEK': ['xan'],
    'SEL': ['sel'],
    'SGA': ['sga'],
    'SGO': ['sag'],
    'SGS': ['sgs'],
    'SHI': ['shi'],
    'SHN': ['shn'],
    'SIB': ['sjo'],
    'SID': ['sid'],
    'SIG': ['xst'],
    'SKS': ['sms'],
    'SKY': ['slk'],
    'SCS': ['scs'],
    'SLA': ['scs', 'xsl'],
    'SLV': ['slv'],
    'SML': ['som'],
    'SMO': ['smo'],
    'SNA': ['seh'],
    'SNA0': ['sna'],
    'SND': ['snd'],
    'SNH': ['sin'],
    'SNK': ['snk'],
    'SOG': ['gru'],
    'SOP': ['sop'],
    'SOT': ['sot'],
    'SQI': ['sqi'],
    'SRB': ['srp'],
    'SRD': ['srd'],
    'SRK': ['skr'],
    'SRR': ['srr'],
    'SSL': ['xsl'],
    'SSM': ['sma'],
    'STQ': ['stq'],
    'SUK': ['suk'],
    'SUN': ['sun'],
    'SUR': ['suq'],
    'SVA': ['sva'],
    'SVE': ['swe'],
    'SWA': ['aii'],
    'SWK': ['swa'],
    'SWZ': ['ssw'],
    'SXT': ['ngo'],
    'SXU': ['sxu'],
    'SYL': ['syl'],
    'SYR': ['aii', 'amw', 'cld', 'syc', 'syr', 'tru'],
    'SYRE': ['syc', 'syr'],
    'SYRJ': ['syc', 'syr'],
    'SYRN': ['syc', 'syr'],
    'SZL': ['szl'],
    'TAB': ['tab'],
    'TAJ': ['tgk'],
    'TAM': ['tam'],
    'TAT': ['tat'],
    'TCR': ['cwd'],
    'TDD': ['tdd'],
    'TEL': ['tel'],
    'TET': ['tet'],
    'TGL': ['tgl'],
    'TGN': ['ton'],
    'TGR': ['tig'],
    'TGY': ['tir'],
    'THA': ['tha'],
    'THT': ['tah'],
    'TIB': ['bod'],
    'TIV': ['tiv'],
    'TKM': ['tuk'],
    'TMH': ['tmh'],
    'TMN': ['tem'],
    'TNA': ['tsn'],
    'TNE': ['enh'],
    'TNG': ['toi'],
    'TOD': ['xal'],
    'TOD0': ['tod'],
    'TPI': ['tpi'],
    'TRK': ['tur'],
    'TSG': ['tso'],
    'TUA': ['tru'],
    'TUM': ['tum'],
    'TUL': ['tcy'],
    'TUV': ['tyv'],
    'TVL': ['tvl'],
    'TWI': ['aka'],
    'TYZ': ['tyz'],
    'TZM': ['tzm'],
    'TZO': ['tzo'],
    'UDM': ['udm'],
    'UKR': ['ukr'],
    'UMB': ['umb'],
    'URD': ['urd'],
    'USB': ['hsb'],
    'UYG': ['uig'],
    'UZB': ['uzb'],
    'VEC': ['vec'],
    'VEN': ['ven'],
    'VIT': ['vie'],
    'VOL': ['vol'],
    'VRO': ['vro'],
    'WA': ['wbm'],
    'WAG': ['wbr'],
    'WAR': ['war'],
    'WCR': ['crk'],
    'WEL': ['cym'],
    'WLN': ['wln'],
    'WLF': ['wol'],
    'WTM': ['wtm'],
    'XBD': ['khb'],
    'XHS': ['xho'],
    'XJB': ['xjb'],
    'XOG': ['xog'],
    'XPE': ['xpe'],
    'YAK': ['sah'],
    'YAO': ['yao'],
    'YAP': ['yap'],
    'YBA': ['yor'],
    'YCR': ['cre'],

    'YIM': ['iii'],
    'ZEA': ['zea'],
    'ZGH': ['zgh'],
    'ZHA': ['zha'],
    'ZHH': ['zho'],
    'ZHP': ['zho'],
    'ZHS': ['zho'],
    'ZHT': ['zho'],
    'ZND': ['zne'],
    'ZUL': ['zul'],
    'ZZA': ['zza'],
}


def features_from_style(style):
    features = style['font-feature-settings'].copy()  # type: dict

    font_kerning = style['font-kerning']
    if font_kerning == 'none':
        features['kern'] = 0
        features['vkrn'] = 0
    elif font_kerning == 'normal':
        features['kern'] = 1
        features['vkrn'] = 1

    font_variant_alternates = style['font-variant-alternates']
    if font_variant_alternates == ['normal']:
        pass
    else:
        # TODO: support stylistic(<feature-value-name>).
        # TODO: support styleset(<feature-value-name> #).
        # TODO: support character-variant(<feature-value-name> #).
        # TODO: support swash(<feature-value-name>).
        # TODO: support ornaments(<feature-value-name>).
        # TODO: support annotation(<feature-value-name>).
        if 'historical-forms' in font_variant_alternates:
            features['hist'] = 1

    font_variant_caps = style['font-variant-caps']
    if font_variant_caps == 'small-caps':
        features['smcp'] = 1
    elif font_variant_caps == 'all-small-caps':
        features['c2sc'] = 1
        features['smcp'] = 1
    elif font_variant_caps == 'petite-caps':
        features['pcap'] = 1
    elif font_variant_caps == 'all-petite-caps':
        features['c2pc'] = 1
        features['pcap'] = 1
    elif font_variant_caps == 'unicase':
        features['unic'] = 1
    elif font_variant_caps == 'titling-caps':
        features['titl'] = 1

    font_variant_east_asian = style['font-variant-east-asian']
    if 'jis78' in font_variant_east_asian:
        features['jp78'] = 1
    elif 'jis83' in font_variant_east_asian:
        features['jp83'] = 1
    elif 'jis90' in font_variant_east_asian:
        features['jp90'] = 1
    elif 'simplified' in font_variant_east_asian:
        features['smpl'] = 1
    elif 'traditional' in font_variant_east_asian:
        features['trad'] = 1

    if 'full-width' in font_variant_east_asian:
        features['fwid'] = 1
    elif 'proportional-width' in font_variant_east_asian:
        features['pwid'] = 1

    if 'ruby' in font_variant_east_asian:
        features['ruby'] = 1

    font_variant_ligatures = style['font-variant-ligatures']
    if font_variant_ligatures == ['normal']:
        pass
    elif font_variant_ligatures == ['none']:
        features['liga'] = 0
        features['clig'] = 0
        features['dlig'] = 0
        features['hlig'] = 0
        features['calt'] = 0
    else:
        if 'common-ligatures' in font_variant_ligatures:
            features['liga'] = 1
            features['clig'] = 1
        elif 'no-common-ligatures' in font_variant_ligatures:
            features['liga'] = 0
            features['clig'] = 0

        if 'discretionary-ligatures' in font_variant_ligatures:
            features['dlig'] = 1
        elif 'no-discretionary-ligatures' in font_variant_ligatures:
            features['dlig'] = 0

        if 'historical-ligatures' in font_variant_ligatures:
            features['hlig'] = 1
        elif 'no-historical-ligatures' in font_variant_ligatures:
            features['hlig'] = 0

        if 'contextual' in font_variant_ligatures:
            features['calt'] = 1
        elif 'no-contextual' in font_variant_ligatures:
            features['calt'] = 0

    font_variant_numeric = style['font-variant-numeric']
    if font_variant_numeric == ['normal']:
        pass
    else:
        if 'lining-nums' in font_variant_numeric:
            features['lnum'] = 1
        elif 'oldstyle-nums' in font_variant_numeric:
            features['onum'] = 1

        if 'proportional-nums' in font_variant_numeric:
            features['pnum'] = 1
        elif 'tabular-nums' in font_variant_numeric:
            features['tnum'] = 1

        if 'diagonal-fractions' in font_variant_numeric:
            features['frac'] = 1
        elif 'stacked-fractions' in font_variant_numeric:
            features['afrc'] = 1

        if 'ordinal' in font_variant_numeric:
            features['ordn'] = 1

        if 'slashed-zero' in font_variant_numeric:
            features['zero'] = 1

    font_variant_position = style['font-variant-position']
    if font_variant_position == 'sub':
        features['subs'] = 1
    elif font_variant_position == 'super':
        features['sups'] = 1

    return ['{}={}'.format(tag, value) for tag, value in features.items()]


def iso639_codes_from_language_tag(tag):
    codes = language_tag_to_iso639_codes_map.get(tag.upper())
    return codes
